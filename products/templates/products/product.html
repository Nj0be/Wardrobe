<div class="flex flex-row justify-center">
  <div class="inline-flex flex-wrap justify-center lg:flex-nowrap gap-5">
    <div class="hidden xl:block w-[16rem]">
      <div class="mx-auto">
        <div
            class="flex flex-col justify-center items-center px-8 py-5 gap-2 border border-black dark:border-stone-500">
          <p>ORIGINE</p>
          <p class="text-sm text-justify">Facciamo affidamento su requisiti di tracciabilità per
            conoscere la catena di
            approvvigionamento dei nostri prodotti. Chiediamo ai nostri fornitori di essere
            informati in merito a tutti
            gli stabilimenti coinvolti nei processi di produzione, dal filato o dalla fibra, a
            seconda dei casi, fino al
            capo finale di ogni ordine. Ciò include sia le fabbriche di proprietà che quelle
            esterne, nonché gli
            intermediari coinvolti in ogni processo.</p>
        </div>
      </div>
    </div>
    <div
        class="snap-y snap-mandatory snap-center overflow-y-scroll rounded-3xl h-[80vh] min-w-fit">
      {% for image in images %}
        <img src="{{ image }}" alt="{{ product.name }}"
             class="snap-center h-full"/>
      {% endfor %}
    </div>
    <div class="w-2/3 lg:w-[26rem]">
      <div class="xl:top-10 mx-auto">
        <div class="flex flex-col justify-center border border-black dark:border-stone-500">
          <!-- Informazioni prodotto -->
          <div class="flex flex-col justify-center items-center px-8 py-5 gap-7">
            <h2 class="text-gray-900 dark:text-stone-200 text-2xl font-bold font-manrope text-center">{{ product.name }}</h2>
            <div class="inline-flex items-center gap-4">
              {% if not discount %}
                <p class="text-lg font-manrope">{{ price }} EUR</p>
              {% else %}
                <div class="flex flex-col justify-center items-center">
                  <p class="text-lg font-manrope">{{ discounted_price|floatformat:2 }} EUR</p>
                  <div class="inline-flex flex-wrap justify-center items-center gap-2">
                    <p class="text-sm font-manrope line-through">{{ price }} EUR</p>
                    <p class="text-sm font-manrope text-red-500">-{{ discount.percentage }}%</p>
                  </div>
                </div>
              {% endif %}
              <p class="text-2xl">|</p>
              <p>{{ selected_color.name|upper }}</p>
            </div>
            <div class="flex flex-col">
              {% if product.description|length > 250 %}
                <div class="peer order-last">
                  <input type="checkbox" id="collapse" class="peer hidden">
                  <label for="collapse"
                         class="underline before:content-['Mostra_di_più'] peer-checked:before:content-['Mostra_meno'] cursor-pointer"></label>
                </div>
              {% endif %}
              <p>DESCRIZIONE</p>
              <p class="text-sm text-justify {% if product.description|length > 250 %}h-16{% endif %} overflow-hidden peer-has-[:checked]:h-auto peer-has-[:checked]:overflow-auto">{{ product.description }}</p>
            </div>
          </div>

          <!-- Varianti Colori -->
          <div class="flex flex-col border-t border-black dark:border-stone-500">
            <div class="px-10 py-7">
              <p>COLORI</p>
              <div
                  class="inline-flex flex-wrap gap-2 py-2">
                {% for color in colors %}
                  <!-- div necessary (instead of putting everythin inside input) because
                       we don't hover the input but the label! -->
                  <div
                      hx-get="{% url 'product_color' product.id color.id %}"
                      hx-target="#content"
                      hx-push-url="true"
                      hx-params="none"
                      preload="mouseover" preload-images="true"
                  >
                    <input type="radio" name="color" id="color_{{ color.id }}" class="hidden peer"
                        {% if color == selected_color %} checked {% endif %}
                        {% if forloop.first %} required {% endif %}
                    >
                    <label for="color_{{ color.id }}"
                           style="background-color:#{{ color.hex }};"
                           class="inline-flex items-center justify-between px-2.5 py-2.5
                                  cursor-pointer border border-black dark:border-stone-500
                                  {% if color == selected_color %}outline outline-2 outline-black dark:outline-stone-400 outline-offset-2{% endif %}">
                    </label>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>

          <form id="cart-add-form" method="post">{% csrf_token %}
            <!-- Varianti Taglie -->

            <div class="flex flex-col justify-center border-t border-black dark:border-stone-500">
              <div class="flex flex-col justify-center px-10 py-7">
                <p>TAGLIE</p>
                <div
                    class="grid grid-cols-1 md:grid-cols-3 items-center justify-center gap-2 py-2">
                  {% for size, variant in size_variants.items %}
                    <!-- div necessary (instead of putting everythin inside input) because
                         we don't hover the input but the label! -->
                    <div class="grid"
                        hx-get="{% url 'product_color_size' product.id selected_color.id size.id %}"
                        hx-target="#content"
                        hx-push-url="true"
                        hx-params="none"
                        preload="mouseover" preload-images="true"
                    >
                      <input type="radio" name="variant_id" id="size_{{ size.id }}"
                             value="{{ variant.id }}"
                             class="hidden peer" required
                          {% if size == selected_size %} checked {% endif %}
                          {% if not variant %} disabled {% endif %}
                      >
                      <label for="size_{{ size.id }}"
                             class="items-center justify-between text-center
                                  cursor-pointer border border-black dark:border-stone-500 px-4
                                  {% if not variant %} bg-gray-200 dark:bg-zinc-800 {% endif %}
                                  {% if size == selected_size %}outline outline-2 outline-black dark:outline-stone-400 outline-offset-2{% endif %}">
                        <div class="flex flex-col justify-center items-center">
                          <p class="{% if not variant %}line-through{% endif %}">{{ size.name }}</p>
                        </div>
                      </label>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>

            <!-- Aggiungi al carrello -->
            <div class="flex flex-col justify-center border-t border-black dark:border-stone-500">
              <div class="flex flex-col justify-center items-center px-10 py-7">
                <div
                    class="grid grid-cols-1 md:grid-cols-1 xl:grid-cols-2 justify-center items-center text-center w-full">
                  <label for="quantity" class="w-full mx-auto"> QUANTITÀ </label>
                  <input type="number" id="quantity" name="quantity" min="1" max="{{ stock }}"
                         value="1"
                         class="w-full mx-auto border border-solid border-black dark:border-stone-500
                          dark:bg-darkbg"
                      {% if selected_size == None %} disabled {% endif %}>
                </div>
                <div class="mt-2 w-full">
                  <button type="submit" {% if selected_size == None %} disabled {% endif %}
                          class="border border-solid border-black dark:border-stone-500 w-full
                           py-2 mx-auto text-sm md:text-normal xl:text-normal hover:bg-gray-100
                            dark:hover:bg-zinc-800 disabled:bg-gray-200 dark:disabled:bg-zinc-700
                             ring-offset-2 ring-black dark:ring-stone-500 focus:ring-2 dark:ring-offset-darkbg"
                          id="add-to-cart-btn"
                          hx-post="{% url "cart_add" %}"
                          hx-swap="none"
                  >Aggiungi
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="flex flex-col justify-center items-center my-16">
  <div class="w-3/5">
    <!-- Sezione delle recensioni -->
    <div id="reviews" class="mt-14">
      <hr class="mb-10">
      <h2 class="text-gray-900 dark:text-stone-200 text-5xl font-manrope">Recensioni</h2>
      {% if reviews %}
        {% for review in reviews %}
          {% include "products/review.html" %}
        {% endfor %}
      {% else %}
        <p id="no-reviews" class="text-normal text-justify mt-2">Non ci sono recensioni per questo
          prodotto.</p>
      {% endif %}
    </div>

    <!-- Sezione aggiungi recensione -->
    {% include "products/add_review.html" %}
  </div>
</div>
